<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-lg-7 col-xl-6">

      <div class="d-flex align-items-center mb-3">
        <i class="fas fa-user-gear me-2 text-secondary"></i>
        <h2 class="mb-0">Editar perfil</h2>
      </div>

      <%# Exibe erros do Devise em um alerta %>
      <% if resource.errors.any? %>
        <div class="alert alert-danger">
          <div class="d-flex align-items-center mb-2">
            <i class="fas fa-triangle-exclamation me-2"></i>
            <strong><%= pluralize(resource.errors.count, "erro") %> impedem salvar suas alterações:</strong>
          </div>
          <ul class="mb-0 ps-3">
            <% resource.errors.full_messages.each do |msg| %>
              <li><%= msg %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <div class="card shadow-sm rounded-4">
        <div class="card-body">
          <%= form_for(resource,
                       as: resource_name,
                       url: registration_path(resource_name),
                       html: { method: :put, class: "needs-validation", novalidate: true }) do |f| %>

            <!-- Email -->
            <div class="mb-3">
              <label class="form-label" for="user_email">
                <i class="fas fa-envelope me-1 text-muted"></i>Email
              </label>
              <%= f.email_field :email,
                                autofocus: true,
                                autocomplete: "email",
                                class: "form-control",
                                placeholder: "seu@email.com" %>
            </div>

            <!-- Nome -->
            <div class="mb-3">
              <label class="form-label" for="user_nome">
                <i class="fas fa-id-card me-1 text-muted"></i>Nome
                <small class="text-muted">(deixe em branco se não quiser alterar)</small>
              </label>
              <%= f.text_field :nome,
                               autocomplete: "name",
                               class: "form-control",
                               placeholder: "Seu nome" %>
            </div>

            <% if devise_mapping.confirmable? && resource.pending_reconfirmation? %>
              <div class="alert alert-warning d-flex align-items-center">
                <i class="fas fa-clock me-2"></i>
                Aguardando confirmação para: <strong class="ms-1"><%= resource.unconfirmed_email %></strong>
              </div>
            <% end %>

            <!-- Senha atual -->
            <div class="mb-4">
              <label class="form-label" for="user_current_password">
                <i class="fas fa-shield-halved me-1 text-muted"></i>Senha atual
                <small class="text-muted">(precisamos dela para confirmar as alterações)</small>
              </label>
              <%= f.password_field :current_password,
                                   autocomplete: "current-password",
                                   class: "form-control",
                                   placeholder: "Sua senha atual" %>
            </div>

            <!-- Nova senha -->
            <div class="mb-3">
              <label class="form-label" for="user_password">
                <i class="fas fa-lock me-1 text-muted"></i>Nova senha
                <small class="text-muted">(deixe em branco se não quiser alterar)</small>
              </label>
              <%= f.password_field :password,
                                   autocomplete: "new-password",
                                   class: "form-control",
                                   placeholder: "Nova senha" %>
              <% if @minimum_password_length %>
                <div class="form-text"><%= @minimum_password_length %> caracteres no mínimo.</div>
              <% end %>
            </div>

            <!-- Confirmação da nova senha -->
            <div class="mb-3">
              <label class="form-label" for="user_password_confirmation">
                <i class="fas fa-key me-1 text-muted"></i>Confirmação da nova senha
              </label>
              <%= f.password_field :password_confirmation,
                                   autocomplete: "new-password",
                                   class: "form-control",
                                   placeholder: "Confirme a nova senha" %>
            </div>

            <div class="d-flex gap-2">
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-floppy-disk me-1"></i>Salvar alterações
              </button>

              <%= link_to (request.referer || root_path), class: "btn btn-outline-secondary" do %>
                <i class="fas fa-arrow-left me-1"></i>Voltar
              <% end %>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Cancelar conta -->
      <div class="card shadow-sm rounded-4 mt-3 border-danger">
        <div class="card-body">
          <h5 class="card-title text-danger">
            <i class="fas fa-user-slash me-2"></i>Cancelar minha conta
          </h5>
          <p class="text-muted mb-3">Insatisfeito? Essa ação é permanente e removerá seus dados.</p>

          <%= button_to "Cancelar minha conta",
                        registration_path(resource_name),
                        method: :delete,
                        data: { turbo_confirm: "Tem certeza que deseja cancelar sua conta?" },
                        class: "btn btn-danger" %>
        </div>
      </div>

    </div>
  </div>
</div>
